"use strict";(self.webpackChunkio_game_doc=self.webpackChunkio_game_doc||[]).push([[7458],{3866:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"kit/property_change_listener","title":"\u5c5e\u6027\u53d8\u66f4\u76d1\u542c","description":"\u5c5e\u6027\u53d8\u66f4\u76d1\u542c\uff0c\u5f53\u67d0\u4e9b\u5c5e\u6027\u503c\u7684\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u89e6\u53d1\u76d1\u542c\u5668\u3002","source":"@site/docs/kit/property_change_listener.mdx","sourceDirName":"kit","slug":"/kit/property_change_listener","permalink":"/game/docs/kit/property_change_listener","draft":false,"unlisted":false,"editUrl":"/docs/kit/property_change_listener.mdx","tags":[],"version":"current","lastUpdatedAt":1750155762000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3,"description":"\u5c5e\u6027\u53d8\u66f4\u76d1\u542c\uff0c\u5f53\u67d0\u4e9b\u5c5e\u6027\u503c\u7684\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u89e6\u53d1\u76d1\u542c\u5668\u3002"},"sidebar":"tutorialSidebar","previous":{"title":"\u8f7b\u91cf\u53ef\u63a7\u7684\u5ef6\u65f6\u4efb\u52a1","permalink":"/game/docs/kit/delay_task"},"next":{"title":"\u6700\u4f73\u5b9e\u6218","permalink":"/game/docs/category/practices"}}');var i=r(4848),l=r(8453);const s={sidebar_position:3,description:"\u5c5e\u6027\u53d8\u66f4\u76d1\u542c\uff0c\u5f53\u67d0\u4e9b\u5c5e\u6027\u503c\u7684\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u89e6\u53d1\u76d1\u542c\u5668\u3002"},o="\u5c5e\u6027\u53d8\u66f4\u76d1\u542c",a={},d=[{value:"\u4ecb\u7ecd",id:"Intro",level:2},{value:"\u5982\u4f55\u4f7f\u7528",id:"How-to-Use",level:2},{value:"BooleanProperty",id:"booleanproperty",level:3},{value:"IntegerProperty",id:"integerproperty",level:3},{value:"ObjectProperty",id:"objectproperty",level:3},{value:"\u79fb\u9664\u76d1\u542c\u5668",id:"Remove-Listener",level:2},{value:"\u5c0f\u7ed3",id:"summary",level:2},{value:"\u6269\u5c55\u9605\u8bfb",id:"Further-Reading",level:2},{value:"\u6848\u4f8b\uff0c\u76d1\u542c\u623f\u95f4\u7684\u6e38\u620f\u72b6\u6001",id:"Case-Monitoring-Room-Game-State",level:3},{value:"\u6848\u4f8b\uff0c\u4e0e\u52a8\u6001\u5c5e\u6027\u7ed3\u5408",id:"Cases-Combined-With-Dynamic-Attributes",level:3}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\u5c5e\u6027\u53d8\u66f4\u76d1\u542c",children:"\u5c5e\u6027\u53d8\u66f4\u76d1\u542c"})}),"\n",(0,i.jsx)(n.h2,{id:"Intro",children:"\u4ecb\u7ecd"}),"\n",(0,i.jsx)(n.p,{children:"\u5c5e\u6027\u53ef\u6dfb\u52a0\u76d1\u542c\u5668\uff0c\u5f53\u67d0\u4e9b\u5c5e\u6027\u503c\u7684\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u89e6\u53d1\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u5c5e\u6027\u76d1\u542c\u7279\u70b9"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u53ef\u4e3a\u5c5e\u6027\u6dfb\u52a0\u76d1\u542c\u5668\uff0c\u7528\u4e8e\u89c2\u5bdf\u5c5e\u6027\u503c\u7684\u53d8\u5316\u3002"}),"\n",(0,i.jsx)(n.li,{children:"\u5c5e\u6027\u53ef\u4ee5\u6dfb\u52a0\u591a\u4e2a\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsx)(n.li,{children:"\u5c5e\u6027\u7684\u76d1\u542c\u5668\u53ef\u4ee5\u79fb\u9664\u3002"}),"\n"]}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.p,{children:"\u6846\u67b6\u5df2\u7ecf\u5185\u7f6e\u4e86\u51e0\u4e2a\u5c5e\u6027\u5b9e\u73b0\u7c7b\uff0c\u5206\u522b\u662f"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"IntegerProperty"}),"\n",(0,i.jsx)(n.li,{children:"LongProperty"}),"\n",(0,i.jsx)(n.li,{children:"StringProperty"}),"\n",(0,i.jsx)(n.li,{children:"BooleanProperty"}),"\n",(0,i.jsx)(n.li,{children:"ObjectProperty"}),"\n"]}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u4f7f\u7528\u573a\u666f 1"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u6bd4\u5982\u73a9\u5bb6\u7684\u8840\u91cf\u4f4e\u4e8e\u4e00\u5b9a\u503c\u65f6\uff0c\u9700\u8981\u89e6\u53d1\u65e0\u654c\u72b6\u6001\u3002\n\u6b64\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u76d1\u542c\u73a9\u5bb6\u7684\u8840\u91cf\uff0c\u5e76\u5728\u8be5\u5c5e\u6027\u4e0a\u6dfb\u52a0\u4e00\u4e2a\u5bf9\u5e94\u7684\u76d1\u542c\u5668\u6765\u89c2\u5bdf\u8840\u91cf\u7684\u53d8\u5316\uff0c\u5f53\u8fbe\u5230\u9884\u671f\u503c\u65f6\u5c31\u89e6\u53d1\u5bf9\u5e94\u7684\u4e1a\u52a1\u3002"}),"\n"]}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u4f7f\u7528\u573a\u666f 2"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u6211\u8fd8\u53ef\u4ee5\u901a\u8fc7\u8be5\u7279\u6027\u6765\u7ba1\u7406\u623f\u95f4\u72b6\u6001\uff0c\u5f53\u623f\u95f4\u72b6\u6001\u53d8\u66f4\u65f6\uff0c\u76d1\u542c\u5668\u53ef\u4ee5\u6267\u884c\u76f8\u5e94\u7684\u4e1a\u52a1\u3002"}),"\n"]}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.p,{children:"\u7c7b\u4f3c\u7684\u4f7f\u7528\u573a\u666f\u8fd8\u6709\u5f88\u591a\uff0c\u8fd9\u91cc\u5c31\u4e0d\u8fc7\u591a\u7684\u4e3e\u4f8b\u4e86\uff0c\u5c5e\u6027\u76d1\u542c\u7684\u7279\u70b9\u5728\u4e8e\u5c5e\u6027\u53d8\u5316\u540e\u4f1a\u89e6\u53d1\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"How-to-Use",children:"\u5982\u4f55\u4f7f\u7528"}),"\n",(0,i.jsx)(n.h3,{id:"booleanproperty",children:"BooleanProperty"}),"\n",(0,i.jsx)(n.p,{children:"\u5f53 BooleanProperty \u5bf9\u8c61\u7684\u503c\u53d1\u751f\u6539\u53d8\u65f6\uff0c\u89e6\u53d1\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"code 2\uff0c\u6dfb\u52a0\u4e00\u4e2a\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsx)(n.li,{children:"code 7\uff0c\u503c\u53d8\u66f4\u65f6\uff0c\u5c06\u4f1a\u89e6\u53d1\u76d1\u542c\u5668"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:"showLineNumbers",children:'var property = new BooleanProperty();\n// highlight-next-line\nproperty.addListener((observable, oldValue, newValue) -> {\n   log.info("oldValue:{}, newValue:{}", oldValue, newValue);\n});\n\nproperty.get(); // value is false\n// highlight-next-line\nproperty.set(true);\nproperty.get(); // value is true\n'})}),"\n",(0,i.jsx)(n.h3,{id:"integerproperty",children:"IntegerProperty"}),"\n",(0,i.jsx)(n.p,{children:"\u5f53 IntegerProperty \u5bf9\u8c61\u7684\u503c\u53d1\u751f\u6539\u53d8\u65f6\uff0c\u89e6\u53d1\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"code 2\uff0c\u6dfb\u52a0\u4e00\u4e2a\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsx)(n.li,{children:"code 7\uff0c\u503c\u53d8\u66f4\u65f6\uff0c\u5c06\u4f1a\u89e6\u53d1\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsx)(n.li,{children:"code 10\uff0cIntegerProperty \u589e\u52a0\u503c\u7684\u4fbf\u6377\u65b9\u6cd5\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:"showLineNumbers",children:'var property = new IntegerProperty();\n// highlight-next-line\nproperty.addListener((observable, oldValue, newValue) -> {\n   log.info("oldValue:{}, newValue:{}", oldValue, newValue);\n});\n\nproperty.get(); // value is 0\n// highlight-next-line\nproperty.set(22);\nproperty.get(); // value is 22\n\n// highlight-next-line\nproperty.increment(); // value is 23. will trigger listeners\n'})}),"\n",(0,i.jsx)(n.h3,{id:"objectproperty",children:"ObjectProperty"}),"\n",(0,i.jsx)(n.p,{children:"\u5f53 ObjectProperty \u5bf9\u8c61\u5185\u503c\u7684\u5f15\u7528\u53d1\u751f\u6539\u53d8\u65f6\uff0c\u89e6\u53d1\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"code 4\uff0c\u6dfb\u52a0\u4e00\u4e2a\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsx)(n.li,{children:"code 8\uff0c\u4e0d\u4f1a\u89e6\u53d1\u76d1\u542c\u5668\uff0c\u56e0\u4e3a\u5f15\u7528\u6ca1\u6709\u53d1\u751f\u53d8\u66f4\u3002"}),"\n",(0,i.jsx)(n.li,{children:"code 11\uff0c\u5f15\u7528\u53d8\u66f4\uff0c\u89e6\u53d1\u76d1\u542c\u5668\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:"showLineNumbers",children:'YourUser user = new YourUser();\n\nvar property = new ObjectProperty(user);\n// highlight-next-line\nproperty.addListener((observable, oldValue, newValue) -> {\n   log.info("oldValue:{}, newValue:{}", oldValue, newValue);\n});\n\n// highlight-next-line\nproperty.set(user); // does not trigger listeners\n\nYourUser user2 = new YourUser();\n// highlight-next-line\nproperty.set(user2);\nproperty.get(); // value is user2\n\nclass YourUser {}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"Remove-Listener",children:"\u79fb\u9664\u76d1\u542c\u5668"}),"\n",(0,i.jsx)(n.p,{children:"\u4e0b\u9762\u8fd9\u4e2a\u793a\u4f8b\uff0c\u6211\u4eec\u5c06 property \u521d\u59cb\u503c\u8bbe\u7f6e\u4e3a 10\uff0c\u968f\u540e\u6dfb\u52a0\u4e86\u4e00\u4e2a\u76d1\u542c\u5668\uff1b\u5f53\u76d1\u542c\u5668\u89c2\u5bdf\u5230\u65b0\u503c\u4e3a 9 \u65f6\uff0c\u5c31\u4ece observable \u4e2d\u79fb\u9664\u81ea\u5df1\uff08\u8fd9\u4e2a\u81ea\u5df1\u6307\u7684\u662f\u76d1\u542c\u5668\u672c\u8eab\uff09\uff0c\u800c observable \u5219\u662f IntegerProperty\u3002"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"code 4\uff0c\u6dfb\u52a0\u4e00\u4e2a\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsx)(n.li,{children:"code 10\uff0c\u79fb\u9664\u5f53\u524d\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsx)(n.li,{children:"code 15\uff0c\u503c\u51cf 1\uff0c\u5f53\u524d\u503c\u4e3a 9\uff0c\u5c06\u4f1a\u89e6\u53d1\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsx)(n.li,{children:"code 16\uff0c\u503c\u51cf 1\uff0c\u5f53\u524d\u503c\u4e3a 8\uff0c\u4f46\u4e0d\u4f1a\u89e6\u53d1\u76d1\u542c\u5668\uff0c\u56e0\u4e3a\u76d1\u542c\u5668\u5df2\u7ecf\u88ab\u79fb\u9664\u4e86\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:"showLineNumbers",children:'public void remove1() {\n    IntegerProperty property = new IntegerProperty(10);\n\n    // highlight-next-line\n    property.addListener(new PropertyChangeListener<>() {\n        @Override\n        public void changed(PropertyValueObservable<? extends Number> observable, Number oldValue, Number newValue) {\n            log.info("1 - newValue : {}", newValue);\n\n            if (newValue.intValue() == 9) {\n                // highlight-next-line\n                observable.removeListener(this);\n            }\n        }\n    });\n\n    // highlight-next-line\n    property.decrement(); // the value is 9\n    // highlight-next-line\n    property.decrement(); // the value is 8\uff0c\u7531\u4e8e\u76d1\u542c\u5668\u5df2\u7ecf\u79fb\u9664\uff0c\u6240\u4ee5\u4e0d\u4f1a\u89e6\u53d1\u4efb\u4f55\u4e8b\u4ef6\u3002\n}\n'})}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.p,{children:"\u4e0b\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u5b9a\u4e49\u4e86\u4e00\u4e2a\u76d1\u542c\u5668\u7c7b OnePropertyChangeListener \u5e76\u5b9e\u73b0\u4e86 PropertyChangeListener \u76d1\u542c\u5668\u63a5\u53e3\u3002\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u901a\u8fc7 OnePropertyChangeListener \u5bf9\u8c61\u7684\u5f15\u7528\u6765\u79fb\u9664\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"code 2\uff0c\u521b\u5efa\u81ea\u5b9a\u4e49\u7684\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsx)(n.li,{children:"code 5\uff0c\u6dfb\u52a0\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsx)(n.li,{children:"code 7\uff0c\u503c\u52a0 1\uff0c\u5f53\u524d\u503c\u4e3a 1\uff0c\u5e76\u89e6\u53d1\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsxs)(n.li,{children:["code 8\uff0c",(0,i.jsx)(n.strong,{children:"\u79fb\u9664\u76d1\u542c\u5668"}),"\u3002"]}),"\n",(0,i.jsx)(n.li,{children:"code 9\uff0c\u503c\u52a0 1\uff0c\u5f53\u524d\u503c\u4e3a 2\uff0c\u4f46\u4e0d\u4f1a\u89e6\u53d1\u76d1\u542c\u5668\uff0c\u56e0\u4e3a\u76d1\u542c\u5668\u5df2\u7ecf\u88ab\u79fb\u9664\u4e86\u3002"}),"\n",(0,i.jsx)(n.li,{children:"code 12\uff0c\u81ea\u5b9a\u4e49\u7684\u76d1\u542c\u5668\u3002"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:"showLineNumbers",children:'public void remove2() {\n    // highlight-next-line\n    OnePropertyChangeListener onePropertyChangeListener = new OnePropertyChangeListener();\n\n    IntegerProperty property = new IntegerProperty();\n    // highlight-next-line\n    property.addListener(onePropertyChangeListener);\n\n    property.increment(); // the value is 1\n    // highlight-next-line\n    property.removeListener(onePropertyChangeListener);\n    property.increment(); // the value is 2\n}\n\n// highlight-next-line\nclass OnePropertyChangeListener implements PropertyChangeListener<Number> {\n    @Override\n    public void changed(PropertyValueObservable<? extends Number> observable, Number oldValue, Number newValue) {\n        log.info("oldValue:{}, newValue:{}, observable:{}", oldValue, newValue, observable);\n    }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"\u5c0f\u7ed3"}),"\n",(0,i.jsxs)(n.p,{children:["\u5c5e\u6027\u76d1\u542c\u5728\u4f7f\u7528\u4e0a\u662f\u7b80\u5355\u7684\uff0c\u5982\u679c\u4f60\u7684\u4e1a\u52a1\u4e2d",(0,i.jsx)(n.strong,{children:"\u6709\u5173\u4e8e\u5c5e\u6027\u53d8\u5316\u540e\u9700\u8981\u89e6\u53d1\u67d0\u4e9b\u4e8b\u4ef6\u7684"}),"\uff0c\n\u53ef\u4ee5\u8003\u8651\u5f15\u7528\u8be5\u7279\u6027\u3002\u6846\u67b6\u4e3a int\u3001long\u3001boolean\u3001Object\u3001String \u7b49\u57fa\u7840\u7c7b\u578b\u63d0\u4f9b\u4e86\u5bf9\u5e94\u7684\u5c5e\u6027\u76d1\u542c\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u5c5e\u6027\u76d1\u542c\u7279\u6027\u652f\u6301\u6dfb\u52a0\u591a\u4e2a\u76d1\u542c\u5668\uff0c\u652f\u6301\u79fb\u9664\u76d1\u542c\u5668\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"Further-Reading",children:"\u6269\u5c55\u9605\u8bfb"}),"\n",(0,i.jsx)(n.h3,{id:"Case-Monitoring-Room-Game-State",children:"\u6848\u4f8b\uff0c\u76d1\u542c\u623f\u95f4\u7684\u6e38\u620f\u72b6\u6001"}),"\n",(0,i.jsx)(n.p,{children:"\u76d1\u542c\u4e0d\u540c\u7684\u623f\u95f4\u6e38\u620f\u72b6\u6001\uff0c\u6765\u89e6\u53d1\u4e1a\u52a1\u65b9\u6cd5\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",children:"public class FairRoom extends SimpleRoom {\n    ...\n    final ObjectProperty<GameStatus> gameStatus = new ObjectProperty<>(GameStatus.NONE);\n\n    private void extractedInitGameStatus() {\n        this.gameStatus.addListener((observable, oldValue, newValue) -> {\n            switch (newValue) {\n                case START -> nextRound();\n                case SETTLE -> settle();\n            }\n        });\n    }\n\n    public void changeGameStatus(GameStatus status) {\n        this.executeTask(() -> this.gameStatus.set(status));\n    }\n\n    public void changeGameStatus(GameStatus status, long millis) {\n        this.executeDelayTask(() -> this.gameStatus.set(status), millis);\n    }\n}\n\npublic enum GameStatus {\n    NONE,\n    START,\n    SETTLE\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"Cases-Combined-With-Dynamic-Attributes",children:"\u6848\u4f8b\uff0c\u4e0e\u52a8\u6001\u5c5e\u6027\u7ed3\u5408"}),"\n",(0,i.jsxs)(n.p,{children:["\u8fd9\u662f\u4e00\u4e2a\u5c5e\u6027\u76d1\u542c\u4e0e",(0,i.jsx)(n.a,{href:"https://iohao.github.io/javadoc/com/iohao/game/common/kit/attr/AttrOptionDynamic.html",children:"\u52a8\u6001\u5c5e\u6027"}),"\u7ed3\u5408\u7684\u4e00\u4e2a\u6848\u4f8b\u3002"]}),"\n",(0,i.jsx)("br",{}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u4e1a\u52a1\u63cf\u8ff0"})}),"\n",(0,i.jsxs)(n.p,{children:["see ",(0,i.jsx)(n.a,{href:"https://github.com/iohao/ioGame/issues/259",children:"https://github.com/iohao/ioGame/issues/259"})]}),"\n",(0,i.jsx)(n.p,{children:"\u8be5 Issue \u60f3\u5728\u6a21\u62df\u5ba2\u6237\u7aef\u4e2d\u901a\u8fc7\u8bb0\u5f55\u5fc3\u8df3\u53d1\u9001\u7684\u6b21\u6570\uff0c\u5f53\u5fc3\u8df3\u89e6\u53d1\u5230\u4e00\u5b9a\u6b21\u6570\u540e\uff0c\u89e6\u53d1\u4e00\u4e9b\u81ea\u5b9a\u4e49\u903b\u8f91\uff0c\u5982\u5173\u95ed\u6a21\u62df\u5ba2\u6237\u7aef\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u8be5\u4e1a\u52a1\u6211\u4eec\u53ef\u4ee5\u5c5e\u6027\u76d1\u542c\u4e0e\u52a8\u6001\u5c5e\u6027\u7ed3\u5408\uff0c\u5728\u6a21\u62df\u5ba2\u6237\u7aef\u4e2d\uff0c\u6211\u4eec\u4e3a clientUser \u6dfb\u52a0\u4e00\u4e2a\u52a8\u6001\u5c5e\u6027 idleCounter\u3002\nidleCounter \u662f IntegerProperty \u7c7b\u578b\u7684\uff0c\u6211\u4eec\u4e3a\u8be5\u5c5e\u6027\u6dfb\u52a0\u4e86\u4e00\u4e2a\u76d1\u542c\u4e8b\u4ef6\uff0c\u5f53 idleCounter \u5fc3\u8df3\u503c\u5927\u4e8e 10 \u65f6\uff0c\u5c31\u8ba9\u6a21\u62df\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u65ad\u5f00\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u53ef\u4ee5\u770b\u51fa\uff0c\u5f53\u5c5e\u6027\u76d1\u542c\u4e0e\u52a8\u6001\u5c5e\u6027\u7ed3\u5408\u540e\uff0c\u53ef\u4ee5\u7684\u8f7b\u677e\u5b9e\u73b0\u8fd9\u4e00\u7279\u6b8a\u9700\u6c42\u3002"}),"\n",(0,i.jsx)(n.p,{children:"\u7531\u4e8e\u6a21\u62df\u5ba2\u6237\u7aef\u672c\u8eab\u6ca1\u6709\u63d0\u4f9b\u5fc3\u8df3\u8bb0\u5f55\u7684\u5c5e\u6027\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u901a\u8fc7\u52a8\u6001\u5c5e\u6027\u4e3a\u8be5 clientUser \u63d0\u4f9b\u4e00\u4e2a\u5c5e\u6027\uff0c\u7528\u4e8e\u8bb0\u5f55\u5fc3\u8df3\u503c\u3002\n\u800c\u4e1a\u52a1\u4e2d\u53c8\u60f3\u8ba9\u5fc3\u8df3\u503c\u8fbe\u5230\u4e00\u5b9a\u6b21\u6570\u540e\u89e6\u53d1\u81ea\u5b9a\u4e49\u7684\u4e1a\u52a1\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u901a\u8fc7 xxxProperty\uff08\u5c5e\u6027\u76d1\u542c\uff09\u6765\u76d1\u542c\u5fc3\u8df3\u503c\u7684\u53d8\u5316\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-java",metastring:"showLineNumbers",children:'public static void main(String[] args) {\n    int idlePeriod = 3;\n    // \u6a21\u62df\u7684\u73a9\u5bb6\n    var clientUser = getDefaultClientUser(idlePeriod);\n\n    new ClientRunOne()\n            .setClientUser(clientUser)\n            // \u5f00\u542f\u5fc3\u8df3\uff0c\u6bcf N \u79d2\u5411\u670d\u52a1\u5668\u53d1\u9001\u4e00\u6b21\u5fc3\u8df3\u6d88\u606f\n            .idle(idlePeriod)\n            .startup();\n}\n\nprivate static DefaultClientUser getDefaultClientUser(int idlePeriod) {\n    // \u52a8\u6001\u5c5e\u6027 key\n    // highlight-next-line\n    AttrOption<IntegerProperty> idleOption = AttrOption.valueOf("idleOption");\n    // \u6a21\u62df\u7684\u5fc3\u8df3\u8ba1\u6570\u5668\n    IntegerProperty idleCounter = new IntegerProperty();\n    // \u6dfb\u52a0\u4e00\u4e2a\u76d1\u542c\u5668\uff0c\u5f53\u503c\u53d1\u751f\u53d8\u5316\u65f6\u4f1a\u89e6\u53d1\u76d1\u542c\u5668\n    idleCounter.addListener((observable, oldValue, newValue) -> {\n        if (newValue.intValue() > 10) {\n            // highlight-next-line\n            clientUser.getClientUserChannel().closeChannel();\n        }\n    });\n\n    // \u7ed9 clientUser \u6dfb\u52a0\u4e00\u4e2a\u52a8\u6001\u5c5e\u6027\n    var clientUser = new DefaultClientUser();\n    // highlight-next-line\n    clientUser.option(idleOption, idleCounter);\n\n    // \u6bcf N \u79d2\u6267\u884c\u4e00\u6b21\n    TaskKit.runInterval(() -> {\n        // \u5fc3\u8df3\u8ba1\u6570\u5668 + 1\uff0c\u6bcf\u6b21\u503c\u53d8\u66f4\uff0c\u5e76\u89e6\u53d1\u76d1\u542c\n        // highlight-next-line\n        clientUser.ifPresent(idleOption, IntegerProperty::increment);\n    }, idlePeriod, TimeUnit.SECONDS);\n\n    return clientUser;\n}\n'})})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>o});var t=r(6540);const i={},l=t.createContext(i);function s(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);