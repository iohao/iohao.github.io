"use strict";(self.webpackChunkio_game_doc=self.webpackChunkio_game_doc||[]).push([[9803],{316:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>o,toc:()=>r});const o=JSON.parse('{"id":"manual/flow_context_attachment","title":"\u5143\u4fe1\u606f-\u9644\u52a0\u4fe1\u606f","description":"\u4ecb\u7ecd","source":"@site/docs/manual/flow_context_attachment.mdx","sourceDirName":"manual","slug":"/manual/flow_context_attachment","permalink":"/game/en/docs/manual/flow_context_attachment","draft":false,"unlisted":false,"editUrl":"/docs/manual/flow_context_attachment.mdx","tags":[],"version":"current","lastUpdatedAt":1750226744000,"sidebarPosition":28,"frontMatter":{"sidebar_position":28},"sidebar":"tutorialSidebar","previous":{"title":"\u5168\u94fe\u8def\u8c03\u7528\u65e5\u5fd7\u8ddf\u8e2a","permalink":"/game/en/docs/manual/trace"},"next":{"title":"pb\u3001json \u6570\u636e\u534f\u8bae\u6269\u5c55","permalink":"/game/en/docs/manual/data_protocol"}}');var a=n(4848),c=n(8453);const l={sidebar_position:28},i="\u5143\u4fe1\u606f-\u9644\u52a0\u4fe1\u606f",s={},r=[{value:"\u4ecb\u7ecd",id:"Intro",level:2},{value:"\u5982\u4f55\u4f7f\u7528",id:"How-to-Use",level:2},{value:"\u81ea\u5b9a\u4e49\u5143\u4fe1\u606f\u7c7b",id:"Custom-Attachment",level:3},{value:"\u66f4\u65b0\u5143\u4fe1\u606f",id:"Update-Attachment",level:3},{value:"\u83b7\u53d6\u5143\u4fe1\u606f",id:"Getting-Attachment",level:3},{value:"\u914d\u5408\u81ea\u5b9a\u4e49 FlowContext",id:"Coordination-FlowContext",level:2},{value:"\u6ce8\u610f\u4e8b\u9879",id:"Notes-and-Considerations",level:2},{value:"Example Source Code",id:"example-source-code",level:2}];function h(e){const t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"\u5143\u4fe1\u606f-\u9644\u52a0\u4fe1\u606f",children:"\u5143\u4fe1\u606f-\u9644\u52a0\u4fe1\u606f"})}),"\n",(0,a.jsx)(t.h2,{id:"Intro",children:"\u4ecb\u7ecd"}),"\n",(0,a.jsx)(t.p,{children:"\u5728\u5904\u7406 action \u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 FlowContext.userId \u53ef\u4ee5\u5f88\u65b9\u4fbf\u5f97\u5230\u5f53\u524d\u73a9\u5bb6 id\u3002"}),"\n",(0,a.jsx)(t.p,{children:"\u5982\u679c\u5f00\u53d1\u8005\u60f3\u5728\u5904\u7406 action \u65f6\uff0c\u643a\u5e26\u4e0a\u4e00\u4e9b\u81ea\u5b9a\u4e49\u7684\u4fe1\u606f\uff0c\u53ef\u4ee5\u901a\u8fc7\u5143\u9644\u52a0\u4fe1\u606f\u7279\u6027\u6765\u5b8c\u6210\u3002\n\u5c06\u4e00\u4e9b\u81ea\u5b9a\u4e49\u4fe1\u606f\u4fdd\u5b58\u5230\u5143\u9644\u52a0\u4fe1\u606f\u540e\uff0c\u4e4b\u540e\u7684\u6bcf\u4e2a action \u8bf7\u6c42\u53ef\u4ee5\u901a\u8fc7 FlowContext \u6765\u5f97\u5230\u8fd9\u4e9b\u81ea\u5b9a\u4e49\u4fe1\u606f\u3002"}),"\n",(0,a.jsx)(t.p,{children:"\u6bd4\u5982\u4fdd\u5b58\u5f53\u524d\u73a9\u5bb6\u7684\u82f1\u96c4\u89d2\u8272\u4fe1\u606f\u3001\u73a9\u5bb6\u6635\u79f0\uff0c\u53c8\u6216\u8005\u662f\u4f60\u7684\u9879\u76ee\u7684 userId \u662f string \u6216\u5176\u4ed6\u7c7b\u578b\u5219\u53ef\u4ee5\u901a\u8fc7\u5143\u4fe1\u606f\u8fd9\u4e00\u7279\u6027\u6765\u517c\u5bb9\u3002"}),"\n",(0,a.jsx)(t.p,{children:"\u7b80\u5355\u7684\u8bf4\uff0c\u5c31\u662f\u4f60\u60f3\u5728 FlowContext \u4e2d\u83b7\u53d6\u4e00\u4e9b\u73a9\u5bb6\u7279\u6709\u7684\u4fe1\u606f\u6570\u636e\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u7279\u6027\u6765\u5b9e\u73b0\u3002"}),"\n",(0,a.jsx)(t.h2,{id:"How-to-Use",children:"\u5982\u4f55\u4f7f\u7528"}),"\n",(0,a.jsx)(t.h3,{id:"Custom-Attachment",children:"\u81ea\u5b9a\u4e49\u5143\u4fe1\u606f\u7c7b"}),"\n",(0,a.jsxs)(t.p,{children:["\u81ea\u5b9a\u4e49\u4e00\u4e2a\u5143\u4fe1\u606f\u7c7b\uff0c\u5b9e\u73b0 ",(0,a.jsx)(t.a,{href:"https://iohao.github.io/javadoc/com/iohao/game/core/common/client/Attachment.html",children:"Attachment"}),"\n\u5143\u9644\u52a0\u4fe1\u606f\u63a5\u53e3"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",children:"@ProtobufClass\npublic class MyAttachment implements Attachment {\n    @Getter\n    long userId;\n    public String nickname;\n}\n"})}),"\n",(0,a.jsx)(t.h3,{id:"Update-Attachment",children:"\u66f4\u65b0\u5143\u4fe1\u606f"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"code 7\uff0c\u66f4\u65b0\u5143\u4fe1\u606f"}),"\n"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",metastring:"showLineNumbers",children:'@ActionMethod(1)\npublic void attachment(FlowContext flowContext) {\n    MyAttachment myAttachment = new MyAttachment();\n    myAttachment.userId = flowContext.getUserId();\n    myAttachment.nickname = "Michael Jackson";\n\n    // highlight-next-line\n    flowContext.updateAttachment(myAttachment);\n}\n'})}),"\n",(0,a.jsx)(t.h3,{id:"Getting-Attachment",children:"\u83b7\u53d6\u5143\u4fe1\u606f"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"code 7\uff0c\u83b7\u53d6\u5143\u4fe1\u606f\uff0c\u8fd9\u4e2a\u662f\u5728\u4e0a\u9762\u7684\u65b9\u6cd5\u4e2d\u8bbe\u7f6e\u7684\u5143\u4fe1\u606f\u5bf9\u8c61"}),"\n"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",metastring:"showLineNumbers",children:"@ActionMethod(2)\npublic MyAttachment printAttachment(FlowContext flowContext) {\n    var attachment = flowContext.getAttachment(MyAttachment.class);\n    return attachment;\n}\n"})}),"\n",(0,a.jsx)(t.h2,{id:"Coordination-FlowContext",children:"\u914d\u5408\u81ea\u5b9a\u4e49 FlowContext"}),"\n",(0,a.jsxs)(t.p,{children:["\u6211\u4eec\u53ef\u4ee5\u914d\u5408",(0,a.jsx)(t.a,{href:"/docs/manual/flow_context#custom_flowcontext",children:"\u81ea\u5b9a\u4e49 FlowContext"})," \u7279\u6027 \uff0c\u505a\u4e00\u4e9b\u66f4\u7b26\u5408\u5b9a\u5236\u7684\u6269\u5c55\uff0c\u5982\u4e0b\u3002"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["code 5\uff0c\u8c03\u7528 ",(0,a.jsx)(t.code,{children:"MyFlowContext.getNickname()"})," \u65b9\u6cd5"]}),"\n",(0,a.jsx)(t.li,{children:"code 9\uff0c\u81ea\u5b9a\u4e49 MyFlowContext\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u8be5\u7c7b\u4e2d\u6dfb\u52a0\u4efb\u610f\u7684\u4fbf\u6377\u65b9\u6cd5\u3002"}),"\n"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-java",metastring:"showLineNumbers",children:"@ActionController(1)\npublic class DemoAction {\n    @ActionMethod(1)\n    public String getNickname(MyFlowContext flowContext) {\n        // highlight-next-line\n        return flowContext.getNickname();\n    }\n}\n\n// highlight-next-line\npublic class MyFlowContext extends FlowContext {\n    MyAttachment attachment;\n\n    @Override\n    public MyAttachment getAttachment() {\n        if (Objects.isNull(attachment)) {\n            this.attachment = this.getAttachment(MyAttachment.class);\n        }\n\n        return this.attachment;\n    }\n\n    public String getNickname() {\n        MyAttachment attachment = this.getAttachment();\n        return attachment.nickname;\n    }\n}\n"})}),"\n",(0,a.jsx)(t.h2,{id:"Notes-and-Considerations",children:"\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,a.jsxs)(t.p,{children:["\u7531\u4e8e ",(0,a.jsx)(t.a,{href:"https://iohao.github.io/javadoc/com/iohao/game/core/common/client/Attachment.html",children:"Attachment"}),"\n\u5b9e\u73b0\u4e86 ",(0,a.jsx)(t.code,{children:"Serializable"})," \u63a5\u53e3\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5c06\u8be5\u7c7b\u653e\u5230\u4e00\u4e2a\u516c\u5171\u5305\u4e2d\uff0c\u4e4b\u540e\u5728\u6e38\u620f\u5bf9\u5916\u670d\u3001Broker\uff08\u6e38\u620f\u7f51\u5173\uff09\u3001\u6e38\u620f\u903b\u8f91\u670d\u7684 pom.xml \u4e2d\u6dfb\u52a0\u8fd9\u4e2a\u516c\u5171\u5305\u3002"]}),"\n",(0,a.jsx)(t.h2,{id:"example-source-code",children:"Example Source Code"}),"\n",(0,a.jsxs)(t.p,{children:["\u53ef\u53c2\u8003",(0,a.jsx)(t.a,{href:"/docs/examples/server/example_spring_boot",children:"\u7efc\u5408\u793a\u4f8b"}),"\u6e90\u7801\u76ee\u5f55\u3002"]}),"\n",(0,a.jsxs)(t.blockquote,{children:["\n",(0,a.jsx)(t.p,{children:"/spring-game-logic-hall/ ... /LoginAction.java"}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,c.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>i});var o=n(6540);const a={},c=o.createContext(a);function l(e){const t=o.useContext(c);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),o.createElement(c.Provider,{value:t},e.children)}}}]);