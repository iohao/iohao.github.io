"use strict";(self.webpackChunkio_game_doc=self.webpackChunkio_game_doc||[]).push([[9875],{665:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>h,frontMatter:()=>t,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"core/jsr380","title":"JSR380 \u9a8c\u8bc1\u89c4\u8303","description":"\u4ecb\u7ecd","source":"@site/docs/core/jsr380.mdx","sourceDirName":"core","slug":"/core/jsr380","permalink":"/game/en/docs/core/jsr380","draft":false,"unlisted":false,"editUrl":"/docs/core/jsr380.mdx","tags":[],"version":"current","lastUpdatedAt":1750155762000,"sidebarPosition":11,"frontMatter":{"sidebar_position":11},"sidebar":"tutorialSidebar","previous":{"title":"Runner \u6269\u5c55\u673a\u5236","permalink":"/game/en/docs/core/runner"},"next":{"title":"\u4e1a\u52a1\u6846\u67b6 - \u63d2\u4ef6","permalink":"/game/en/docs/category/core_plugin"}}');var r=a(4848),l=a(8453);const t={sidebar_position:11},s="JSR380 \u9a8c\u8bc1\u89c4\u8303",o={},d=[{value:"\u4ecb\u7ecd",id:"Intro",level:2},{value:"\u4e0d\u5f00\u542f\u9a8c\u8bc1\u7684\u793a\u4f8b",id:"Example-Without-Validation",level:2},{value:"\u5982\u4f55\u5b89\u88c5",id:"\u5982\u4f55\u5b89\u88c5",level:2},{value:"\u5982\u4f55\u4f7f\u7528",id:"How-to-Use",level:2},{value:"\u5f00\u542f\u9a8c\u8bc1\u9009\u9879",id:"Enable-Validation-Option",level:3},{value:"action example",id:"action-example",level:3},{value:"\u9a8c\u8bc1\u5931\u8d25\u7684\u6253\u5370\u9884\u89c8",id:"Print-Preview-of-Failed-Validation",level:3},{value:"\u9519\u8bef\u7801 -1001",id:"Error-Code-1001",level:3},{value:"JSR380 \u9a8c\u8bc1\u7ec4",id:"JSR 380 Validation Groups",level:2},{value:"Jakarta \u4e0e Javax",id:"Jakarta-vs-Javax",level:2},{value:"Example Source Code",id:"example-source-code",level:2}];function c(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"jsr380-\u9a8c\u8bc1\u89c4\u8303",children:"JSR380 \u9a8c\u8bc1\u89c4\u8303"})}),"\n",(0,r.jsx)(n.h2,{id:"Intro",children:"\u4ecb\u7ecd"}),"\n",(0,r.jsxs)(n.p,{children:["\u4e1a\u52a1\u6846\u67b6\u652f\u6301 JSR 380 \u9a8c\u8bc1\u89c4\u8303 \uff08\u7531 ",(0,r.jsx)(n.a,{href:"https://hibernate.org/validator/",children:"hibernate-validator"})," \u652f\u6301\uff09\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u4e1a\u52a1\u53c2\u6570\u7684\u9a8c\u8bc1\u4e0d\u5728\u9700\u8981\u5199\u5728\u4e1a\u52a1\u4ee3\u7801\u91cc\u9762\uff0c\u53ef\u4ee5\u4f7f\u5f97\u4e1a\u52a1\u4ee3\u7801\u66f4\u5e72\u51c0\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u82e5\u4e0d\u4f7f\u7528\u9a8c\u8bc1\u6846\u67b6\uff0c\u5e38\u89c4\u7684\u505a\u6cd5\u662f\u4e0d\u65ad\u7684\u5728\u4e1a\u52a1\u4ee3\u7801\u4e2d\u75af\u72c2\u4f7f\u7528 if else \u8f93\u51fa\uff0c\u8fd9\u5c06\u9020\u6210\u4e1a\u52a1\u4ee3\u7801\u6df7\u4e71\u3002\n\u5173\u4e8e\u9a8c\u8bc1\u6846\u67b6\u7684\u66f4\u591a\u7684\u597d\u5904\uff0c\u8bf7\u81ea\u884c\u67e5\u8be2\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u4e0b\u9762\uff0c\u6211\u4eec\u4f7f\u7528\u4e24\u4e2a\u793a\u4f8b\u5bf9\u6bd4\u6765\u8bf4\u660e JSR380 \u7684\u4f18\u52bf\u3002\n\u4e00\u4e2a\u662f\u4f7f\u7528\u4e86 JSR380 \u7684\u793a\u4f8b\uff0c\u4e00\u4e2a\u662f\u6ca1\u6709\u4f7f\u7528 JSR380 \u7684\u793a\u4f8b\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"Example-Without-Validation",children:"\u4e0d\u5f00\u542f\u9a8c\u8bc1\u7684\u793a\u4f8b"}),"\n",(0,r.jsx)(n.p,{children:"\u73b0\u5728\u5148\u8ba9\u6211\u4eec\u770b\u4e00\u4e2a\u6ca1\u6709\u4f7f\u7528 JSR380 \u7684\u793a\u4f8b\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u8fd9\u4e2a\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u5bf9\u7535\u5b50\u90ae\u7bb1\u548c\u5e74\u9f84\u8fd9\u4e24\u4e2a\u5c5e\u6027\u7684\u6570\u636e\u8fdb\u884c\u5408\u6cd5\u9a8c\u8bc1\u3002\n\u9a8c\u8bc1\u5305\u62ec\u90ae\u7bb1\u7684\u683c\u5f0f\u548c\u5e74\u9f84\u7684\u6700\u5c0f\u8303\u56f4\u3002"}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(n.p,{children:"message \u7684\u503c\u8bbe\u7f6e\u5982\u4e0b"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'message.email="a"\uff1b'}),"\n",(0,r.jsx)(n.li,{children:"message.age = 1;"}),"\n"]}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@ActionController(1)\npublic class JsrJakartaAction {\n    @ActionMethod(1)\n    public void verify(ValidMessage message) {\n        String email = message.email;\n\n        GameCode.emailChecked.assertNullThrows(email == null);\n\n        Pattern pattern = Pattern.compile("[a-zA-Z0-9_-]+@\\\\w+\\\\.[a-z]+(\\\\.[a-z]+)?");\n        var result = pattern.matcher(email).find()\n        GameCode.emailChecked.assertTrue(result);\n\n        int age = message.age;\n        GameCode.ageChecked.assertTrueThrows(age < 2);\n\n        // Your biz code\n        ...\n    }\n}\n\n@ProtobufClass\npublic class ValidMessage {\n    public String email;\n    public int age;\n}\n\n@Getter\npublic enum GameCode implements MsgExceptionInfo {\n    emailChecked(100, "Email error."),\n    ageChecked(101, "Age error."),\n    ;\n\n    final int code;\n    final String msg;\n\n    GameCode(int code, String msg) {\n        this.code = code;\n        this.msg = msg;\n    }\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u91cc\u53ea\u6709\u4e24\u4e2a\u5b57\u6bb5\u9700\u8981\u9a8c\u8bc1\uff0c\u5c31\u6709\u5f88\u591a\u4ee3\u7801\u4e86\u3002\n\u5982\u679c\u5728\u591a\u52a0\u51e0\u4e2a\u9700\u8981\u9a8c\u8bc1\u7684\u5b57\u6bb5\u6216\u591a\u51e0\u4e2a\u5b57\u6bb5\u7684\u9a8c\u8bc1\u89c4\u5219\uff0c\u90a3\u4e48\u4ee3\u7801\u5c31\u4f1a\u975e\u5e38\u7684\u591a\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5b9e\u9645\u4e0a\u8fd9\u6837\u7684\u4ee3\u7801\u662f\u91cd\u590d\u7684\uff0c\u5bf9\u4e8e\u8fd9\u6837\u76f8\u5173\u7684\u4ee3\u7801\u5728 JSR380 \u4e2d\u5df2\u7ecf\u7ed9\u51fa\u4e86\u7edf\u4e00\u7684\u89e3\u51b3\u65b9\u6848\u3002\n\u5728\u5927\u90e8\u5206\u7684\u6846\u67b6\u4e2d\u4e5f\u652f\u6301\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u7684\u4e1a\u52a1\u6846\u67b6\u4e5f\u662f\u652f\u6301\u8fd9\u4e9b\u9a8c\u8bc1\u7684\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"\u5982\u4f55\u5b89\u88c5",children:"\u5982\u4f55\u5b89\u88c5"}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsx)(n.p,{children:"JSR380 \u662f\u4e00\u4e2a\u6309\u9700\u4f7f\u7528\u7684\u529f\u80fd\uff0c\u6240\u4ee5\u9700\u8981\u5728\u4f60\u7684\u9879\u76ee maven \u4e2d\u5f15\u5165"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-xml",metastring:'title="pom.xml"',children:"\x3c!-- https://mvnrepository.com/artifact/org.hibernate.validator/hibernate-validator --\x3e\n<dependency>\n  <groupId>org.hibernate.validator</groupId>\n  <artifactId>hibernate-validator</artifactId>\n  <version>7.0.4.Final</version>\n</dependency>\n\n\x3c!-- https://mvnrepository.com/artifact/org.glassfish/jakarta.el --\x3e\n\x3c!-- EL\u5b9e\u73b0\u3002\u5728Java SE\u73af\u5883\u4e2d\uff0c\u60a8\u5fc5\u987b\u5c06\u5b9e\u73b0\u4f5c\u4e3a\u4f9d\u8d56\u9879\u6dfb\u52a0\u5230POM\u6587\u4ef6\u4e2d --\x3e\n<dependency>\n  <groupId>org.glassfish</groupId>\n  <artifactId>jakarta.el</artifactId>\n  <version>4.0.2</version>\n</dependency>\n\n\x3c!-- https://mvnrepository.com/artifact/jakarta.validation/jakarta.validation-api --\x3e\n\x3c!-- \u9a8c\u8bc1\u5668 Maven \u4f9d\u8d56\u9879 --\x3e\n<dependency>\n  <groupId>jakarta.validation</groupId>\n  <artifactId>jakarta.validation-api</artifactId>\n  <version>3.0.2</version>\n</dependency>\n"})}),"\n",(0,r.jsx)(n.h2,{id:"How-to-Use",children:"\u5982\u4f55\u4f7f\u7528"}),"\n",(0,r.jsx)(n.h3,{id:"Enable-Validation-Option",children:"\u5f00\u542f\u9a8c\u8bc1\u9009\u9879"}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u5728\u4e1a\u52a1\u6846\u67b6\u4e2d\u5f00\u542f\u9a8c\u8bc1\u9009\u9879"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"public BarSkeleton createBarSkeleton() {\n    BarSkeletonBuilder builder = ...;\n    // highlight-next-line\n    builder.getSetting().setValidator(true);\n    return builder.build();\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"action-example",children:"action example"}),"\n",(0,r.jsxs)(n.p,{children:["\u6211\u4eec\u7ed9 ",(0,r.jsx)(n.code,{children:"ValidMessage"})," \u52a0\u4e0a\u4e86\u4e00\u4e9b JSR \u76f8\u5173\u7684\u6ce8\u89e3\uff0c\u8fd9\u4e9b\u6ce8\u89e3\u662f\u5e2e\u52a9\u6211\u4eec\u7b80\u5316\u9a8c\u8bc1\u7684\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u540c\u6837\u7684\uff0c\u5728\u8fd9\u4e2a\u793a\u4f8b\u4e2d\u6211\u4eec\u5bf9\u7535\u5b50\u90ae\u7bb1\u548c\u5e74\u9f84\u8fd9\u4e24\u4e2a\u5c5e\u6027\u7684\u6570\u636e\u8fdb\u884c\u5408\u6cd5\u9a8c\u8bc1\uff0c\n\u9a8c\u8bc1\u5305\u62ec\u90ae\u7bb1\u7684\u683c\u5f0f\u548c\u5e74\u9f84\u7684\u6700\u5c0f\u8303\u56f4\u3002"}),"\n",(0,r.jsx)("br",{}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@ActionController(1)\npublic class JsrJakartaAction {\n    @ActionMethod(1)\n    public void verify(ValidMessage message) {\n        // Your biz code\n        ...\n    }\n}\n\n@ProtobufClass\npublic class ValidMessage {\n    // highlight-next-line\n    @NotNull\n    // highlight-next-line\n    @Email\n    public String email;\n\n    // highlight-next-line\n    @Min(value = 2, message = "Age error")\n    public int age;\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u4ee3\u7801\u4e2d\u6ca1\u6709\u4efb\u4f55\u7684\u903b\u8f91\uff08\u5e72\u51c0\u7684\u4e1a\u52a1\u4f53\uff09\uff0c\u56e0\u4e3a\u9a8c\u8bc1\u76f8\u5173\u7684\u903b\u8f91\u5168\u90fd\u7531\u4e1a\u52a1\u6846\u67b6\u6765\u505a\u4e86\uff0c\u5305\u62ec\u9519\u8bef\u7801\u7684\u54cd\u5e94\u3002\n",(0,r.jsx)(n.strong,{children:"\u8fd9\u6bb5\u4ee3\u7801\u4e0e\u4e0a\u9762\u6ca1\u6709\u5f00\u542f\u9a8c\u8bc1\u7684\u793a\u4f8b\u4ee3\u7801\u8fbe\u5230\u540c\u7b49\u7684\u9a8c\u8bc1\u6548\u679c"}),"\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u9664\u4e86\u53ef\u4ee5\u8fbe\u5230\u540c\u7b49\u9a8c\u8bc1\u6548\u679c\u7684\u540c\u65f6\uff0c\u4e1a\u52a1\u6846\u67b6\u8fd8\u505a\u4e86\u4e00\u4e9b\u5c0f\u4f18\u5316\u3002\n\u5982\u679c\u4e1a\u52a1\u53c2\u6570\u9a8c\u8bc1\u6ca1\u6709\u901a\u8fc7\uff0c\u5c31\u4e0d\u4f1a\u6267\u884caction\uff0c\u53ef\u4ee5\u51cf\u5c11\u4e00\u6b21\u635f\u8017\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u4e1a\u52a1\u6846\u67b6\u7ed3\u5408\u4e86 JSR380 \u548c\u5f02\u5e38\u673a\u5236\uff0c\u4f7f\u5f97\u7a0b\u5e8f\u5458\u53ea\u9700\u5173\u6ce8\u771f\u6b63\u7684\u4e1a\u52a1\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"Print-Preview-of-Failed-Validation",children:"\u9a8c\u8bc1\u5931\u8d25\u7684\u6253\u5370\u9884\u89c8"}),"\n",(0,r.jsx)(n.p,{children:'\u56e0\u4e3a email \u5b57\u6bb5\u7ed9\u7684\u503c "a"\uff0c\u6240\u4ee5\u4f1a\u7ed9\u51fa\u5931\u8d25\u7684\u7ed3\u679c\u3002'}),"\n",(0,r.jsx)(n.p,{children:"\u4e1a\u52a1\u6846\u67b6\u4f1a\u628a\u8fd9\u4e2a\u9519\u8bef\u7801\u548c\u9519\u8bef\u63d0\u793a\u7ed9\u5230\u6e38\u620f\u7aef\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:"\u250f\u2501\u2501\u2501\u2501\u2501 Error. [JsrJakartaAction.java] \u2501\u2501\u2501 [.(ValidAction.java:1).validate] \u2501\u2501\u2501 [cmd:1-1] \u2501\u2501\u2501 [JsrLogicServer \u6e38\u620f\u903b\u8f91\u670d]\n\u2523 \u53c2\u6570: validMessage : ValidMessage(email=a, age=2)\n\u2523 \u9519\u8bef\u7801: -1001\n\u2523 \u9a8c\u8bc1\u4fe1\u606f: \u4e0d\u662f\u4e00\u4e2a\u5408\u6cd5\u7684\u7535\u5b50\u90ae\u4ef6\u5730\u5740\n\u2523 \u65f6\u95f4: 0 ms (\u4e1a\u52a1\u65b9\u6cd5\u603b\u8017\u65f6)\n\u2517\u2501\u2501\u2501\u2501\u2501 [ioGame:21.27] \u2501\u2501\u2501\u2501\u2501 [\u7ebf\u7a0b:User-8-3] \u2501\u2501\u2501\u2501\u2501 [\u8fde\u63a5\u65b9\u5f0f:WebSocket] \u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\n"})}),"\n",(0,r.jsx)(n.h3,{id:"Error-Code-1001",children:"\u9519\u8bef\u7801 -1001"}),"\n",(0,r.jsx)(n.p,{children:"\u9519\u8bef\u7801 -1001 \u662f\u4e1a\u52a1\u6846\u67b6\u5185\u5b9a\u7684\u4e00\u4e2a\u54cd\u5e94\u7801\uff0c\u7528\u4e8e\u9a8c\u8bc1\u5931\u8d25\u65f6\u54cd\u5e94\u7ed9\u8bf7\u6c42\u7aef\uff08\u4e00\u822c\u662f\u6e38\u620f\u524d\u7aef\uff09\u7684\u4fe1\u606f\u3002"}),"\n",(0,r.jsx)(n.h2,{id:"JSR 380 Validation Groups",children:"JSR380 \u9a8c\u8bc1\u7ec4"}),"\n",(0,r.jsx)(n.p,{children:"JSR380 \u65b0\u589e\u53c2\u6570\u5206\u7ec4\u6821\u9a8c\uff0c\u5206\u7ec4\u6821\u9a8c\u5728 web \u5f00\u53d1\u4e2d\u5f88\u5e38\u89c1\uff0cioGame \u4e5f\u652f\u6301\u8fd9\u4e00\u7279\u6027\u3002"}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["\u8be5\u7279\u6027\u7531 ",(0,r.jsx)(n.a,{href:"https://gitee.com/q1357199155",children:"\u53cc\u773c\u76ae\u7537\u5b69 - Gitee.com"})," \u8d21\u732e"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-java",children:'@ActionController(1)\npublic class DemoAction {\n    ...\n    @ActionMethod(0)\n    public void validateUpdate(@ValidatedGroup(value = Update.class) BirdValid birdValid) {\n        log.info("dogValid : {}", birdValid);\n    }\n\n    @ActionMethod(1)\n    public void validateCreate(@ValidatedGroup(value = Create.class) BirdValid birdValid) {\n        log.info("dogValid : {}", birdValid);\n    }\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"Jakarta-vs-Javax",children:"Jakarta \u4e0e Javax"}),"\n",(0,r.jsx)(n.p,{children:"\u73b0\u5728 ioGame \u7684 JSR \u6821\u9a8c\u652f\u6301 Jakarta \u548c Javax \u4e24\u79cd\uff0c\u57fa\u4e8e java SPI \u5b9e\u73b0\u3002\n\u652f\u6301 Javax \u662f\u4e3a\u4e86\u517c\u5bb9\u4e00\u4e9b\u8001\u9879\u76ee\uff08\u975e ioGame \u9879\u76ee\uff09\u8fc1\u79fb\u5230 ioGame \u4e2d\u3002\n\u65b0\u9879\u76ee\u63a8\u8350\u4f7f\u7528 Jakarta\uff0c\u901a\u5e38\u5728 ioGame \u7684\u9879\u76ee\u4e2d\uff0c\u5f00\u542f JSR380 \u9a8c\u8bc1\u89c4\u8303\u65f6\uff0c\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f Jakarta\u3002"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u793a\u4f8b\u76ee\u5f55\u4e2d\uff0c\u5355\u72ec\u7684\u589e\u52a0\u4e86 Jakarta \u548c Javax \u7684\u4f7f\u7528\u793a\u4f8b\u3002"}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["\u57fa\u4e8e java SPI \u7684\u5b9e\u73b0\u7531 ",(0,r.jsx)(n.a,{href:"https://gitee.com/shenjk",children:"shenjk"})," \u8d21\u732e\uff1b"]})}),"\n",(0,r.jsx)(n.h2,{id:"example-source-code",children:"Example Source Code"}),"\n",(0,r.jsxs)(n.p,{children:["see ",(0,r.jsx)(n.a,{href:"https://github.com/iohao/ioGameExamples",children:"https://github.com/iohao/ioGameExamples"})]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"path : SimpleExample/example"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"example-jsr-jakarta"}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>t,x:()=>s});var i=a(6540);const r={},l=i.createContext(r);function t(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);